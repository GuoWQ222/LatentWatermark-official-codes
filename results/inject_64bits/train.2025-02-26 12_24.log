2025/02/26 12:24:42 INFO {
    "generator":{
        "ddim":{
            "S":50,
            "eta":0.0,
            "shape":[
                4,
                64,
                64
            ],
            "unconditional_guidance_scale":7.5
        },
        "device":"cuda:0",
        "mix_precision":{
            "fp16_scale_growth":0.001,
            "use_fp16":true
        },
        "model":{
            "kwargs":{
                "channels":4,
                "cond_stage_config":{
                    "params":{},
                    "type":"models.generators.stable_diffusion.encoders.modules.FrozenCLIPEmbedder"
                },
                "cond_stage_key":"txt",
                "cond_stage_trainable":false,
                "conditioning_key":"crossattn",
                "first_stage_config":{
                    "params":{
                        "ddconfig":{
                            "attn_resolutions":[],
                            "ch":128,
                            "ch_mult":[
                                1,
                                2,
                                4,
                                4
                            ],
                            "double_z":true,
                            "dropout":0.0,
                            "in_channels":3,
                            "num_res_blocks":2,
                            "out_ch":3,
                            "resolution":512,
                            "z_channels":4
                        },
                        "embed_dim":4,
                        "lossconfig":{
                            "params":{},
                            "type":"torch.nn.Identity"
                        },
                        "use_fp16":true
                    },
                    "type":"models.generators.stable_diffusion.autoencoder.AutoencoderKL"
                },
                "first_stage_key":"image",
                "image_size":64,
                "log_every_t":200,
                "num_timesteps_cond":1,
                "scale_factor":0.18215,
                "timesteps":1000,
                "unet_config":{
                    "params":{
                        "attention_resolutions":[
                            4,
                            2,
                            1
                        ],
                        "channel_mult":[
                            1,
                            2,
                            4,
                            4
                        ],
                        "context_dim":768,
                        "image_size":64,
                        "in_channels":4,
                        "legacy":false,
                        "model_channels":320,
                        "num_heads":8,
                        "num_res_blocks":2,
                        "out_channels":4,
                        "transformer_depth":1,
                        "use_fp16":true,
                        "use_spatial_transformer":true
                    },
                    "type":"models.generators.stable_diffusion.diffusionmodules.openaimodel.UNetModel"
                },
                "use_fp16":true
            },
            "type":"stable_diffusion"
        },
        "optimizer":{
            "kwargs":{
                "lr":1e-05,
                "weight_decay":0.0
            },
            "type":"AdamW"
        },
        "pretrain":{
            "optimizer":{
                "kwargs":{
                    "lr":0.001,
                    "weight_decay":0.0
                },
                "type":"AdamW"
            },
            "scheduler":{
                "decay":{
                    "kwargs":{
                        "step_size":2000
                    },
                    "type":"StepLR"
                }
            }
        },
        "scheduler":{
            "decay":{
                "kwargs":{
                    "milestones":[
                        25000
                    ]
                },
                "type":"MultiStepLR"
            }
        },
        "sd_ckpt":"./sd_ckpts/stable_diffusion_v1_4.pth"
    },
    "loss":{
        "device":"cuda:0",
        "msg_bit_loss":{
            "kwargs":{
                "mode":"regression"
            },
            "scale":2
        },
        "msg_lse_loss":{
            "kwargs":{},
            "scale":1
        },
        "recon_latent_l2_loss":{
            "kwargs":{},
            "scale":1.5
        },
        "recon_lpips_loss":{
            "kwargs":{},
            "scale":1
        }
    },
    "message_model":{
        "device":"cuda:0",
        "model":{
            "kwargs":{
                "bit_num":64,
                "enc_dim":4096,
                "latent_dim":4096,
                "mode":"regression"
            },
            "type":"NaiveMessageModel"
        },
        "optimizer":{
            "kwargs":{
                "lr":1e-05,
                "weight_decay":0.0
            },
            "type":"AdamW"
        },
        "pretrain":{
            "optimizer":{
                "kwargs":{
                    "lr":0.0001,
                    "weight_decay":0.0
                },
                "type":"AdamW"
            },
            "scheduler":{
                "decay":{
                    "kwargs":{
                        "step_size":4000
                    },
                    "type":"StepLR"
                }
            }
        },
        "scheduler":{
            "decay":{
                "kwargs":{
                    "milestones":[
                        12500
                    ]
                },
                "type":"MultiStepLR"
            }
        }
    },
    "task_cfg":{
        "generation_cfg":{
            "batch_size":6,
            "msg_path":"./datafiles/msg_64.npy",
            "num_per_class":1,
            "prompts":"./datafiles/coco_val_2017_captions.txt",
            "save_path":"./results/inject_64bits/images"
        },
        "log_path":"./results/inject_64bits",
        "running_epoch":1,
        "thr_eval":0.5,
        "thr_stage1":0.99,
        "thr_stage2":0.045,
        "thr_stage3":0.99
    },
    "training_data":{
        "dataloader":{
            "batch_size":2,
            "collate_fn":"collate_fn",
            "num_workers":0,
            "shuffle":true
        },
        "dataset":{
            "data_aug":{},
            "data_json":"./datafiles/captions_train2017.json",
            "preprocess":{
                "norm":{
                    "mean":0.5,
                    "std":0.5
                },
                "random_crop":{
                    "target_size":512
                },
                "rescale":{
                    "min_size":512
                }
            },
            "type":"InjectDataset"
        }
    }
}
2025/02/26 12:24:42 INFO Load pretrained model message_model success!
2025/02/26 12:24:42 INFO Load the pretrained model ./results/inject_64bits/checkpoints/message_model_epoch_-1.pth
2025/02/26 12:24:42 INFO Missing Module: []
2025/02/26 12:24:42 INFO Unexpected Module: []
